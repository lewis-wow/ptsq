# React client

React client is a very thin wrapper of [react query](https://tanstack.com/query/latest).

```ts copy filename="client.ts"
import { createReactClient } from '@ptsq/react-client';
import type { BaseRouter } from './server';

const client = createReactClient<BaseRouter>({
  url: 'http://localhost:4000/ptsq',
});
```

## Query

```tsx copy filename="component.tsx"
export const App = () => {
  const testQuery = await client.test.useQuery({
    name: /* string */ 'John',
  });

  return (
    <main>
      {testQuery.isFetching ? 'Loading...' : testQuery.data /* string */}
    </main>
  )
}
```

## Mutation

```tsx copy filename="component.tsx"
export const App = () => {
  const testMutation = await client.test.useMutation();

  return (
    <main>
      <button onClick={() =>
        testMutation.mutate(/* { name: string } */ {
          name: 'John'
        })
      }>
        Mutate
      </button>
      {testMutation.isFetching ? 'Loading...' : testMutation.data /* string */}
    </main>
  )
}
```

### Query without immediate call

```tsx copy filename="component.tsx"
export const App = () => {
  const testQuery = await client.test.useQuery({
    name: /* string */ 'John',
  }, {
    enabled: false
  });

  return (
    <main>
      <button onClick={() =>
        testQuery.refetch()
      }>
        Query
      </button>
      {testQuery.isFetching ? 'Loading...' : testQuery.data /* string */}
    </main>
  )
}
```

## Infinite query

the `useInfiniteQuery` is exposed only if your server accepts `pageParam` property with any type. That means the input has to extends `{ pageParam: any }`.

```ts copy filename="server.ts"
resolver
  .args(
    Type.Object({
      pageParam: Type.Integer(),
    }),
  )
  .output(
    Type.Object({
      data: Type.Array(Type.String()),
      nextCursor: Type.Integer(),
    }),
  )
  .query(({ input }) => {
    return {
      data: data.slice(
        input.pageParam * pageSize,
        (input.pageParam + 1) * pageSize,
      ),
      nextCursor: input.pageParam + 1,
    };
  });
```

```tsx copy filename="component.tsx"
export const App = () => {
  const infiniteQuery = client.test.useInfiniteQuery(
    {}, // pageParam is automatically passed by the infinite query, you should not have it in the input
    {
      initialPageParam: 0,
      getNextPageParam: (lastPage) => lastPage.nextCursor,
    },
  );

  return (
    <div>
      <p>data: {JSON.stringify(infiniteQuery.data)}</p>
      <button onClick={() => infiniteQuery.fetchNextPage()}>load next</button>
    </div>
  );
};
```
